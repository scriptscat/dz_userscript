<?php/** * 论坛活动接口 */if (!defined('IN_DISCUZ')) {    exit('Access Denied');}global $_G;if ($_G['uid'] <= 0) {    echo json_encode(['code' => -1, 'data' => '请先登录']);    return;}class server{    protected $custom;    public function __construct()    {    }    public function run()    {//        if ($_SERVER['REQUEST_METHOD'] != 'POST') {//            echo json_encode(['code' => -1, 'data' => '请求错误']);//            return;//        }        switch ($_GET['activity']) {            case 'zq2022':                $resp = $this->zq2022();                break;            default:                return;        }        echo json_encode($resp, JSON_UNESCAPED_UNICODE);    }    public function zq2022()    {        global $_G;        // 查找中秋勋章        $medal = DB::fetch_first("SELECT * FROM " . DB::table('forum_medal') . " WHERE name=%s", ["喜迎中秋"]);        if (!$medal) {            return ["code" => -1, "msg" => "勋章已下架"];        }        // 查找是否获得中秋勋章        $item = DB::fetch_first("SELECT * FROM " . DB::table('common_member_medal') . " WHERE uid=%d and medalid=%d",            [$_G["uid"], $medal["medalid"]]);        if ($item) {            return ["code" => -1, "msg" => "已经获得过勋章了,但你还可以继续玩游戏^_^"];        }        DB::insert('common_member_medal', [            'uid' => $_G["uid"],            "medalid" => $medal["medalid"]        ]);        DB::insert("forum_medallog", [            'uid' => $_G["uid"],            'medalid' => $medal["medalid"],            'type' => 0,            'dateline' => time(),            'expiration' => time() + 86400 * 365,            'status' => 0        ]);        $memberfieldforum = C::t('common_member_field_forum')->fetch($_G['uid']);        $usermedal = $memberfieldforum;        unset($memberfieldforum);        $medal['medalid'] = $medal['medalid'].(empty($expiration) ? '' : '|'.$expiration);        $medalnew = $usermedal['medals'] ? $usermedal['medals']."\t".$medal['medalid'] : $medal['medalid'];        C::t('common_member_field_forum')->update($_G['uid'], array('medals' => $medalnew));        return ["code" => 0, "msg" => "勋章获取成功"];    }}$server = new server();$server->run();